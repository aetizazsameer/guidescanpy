configfile: "config.json"
threads: 1

# -----------------------------------------------------------------------------
# Setup
# -----------------------------------------------------------------------------
ORGANISMS = ["sacCer3"]
OUTPUT_DIR = config['output_dir']

shell.executable("/bin/bash")

wildcard_constraints:
    organism = "|".join(ORGANISMS)

# Rules that should be run on the head node in a cluster environment
# These typically involve web access or one time installation steps
localrules:
    download_sequence,
    download_annotations,
    download_chr2acc,
    install_guidescan
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Rules
# -----------------------------------------------------------------------------
rule all:
    input:
        expand(f"{OUTPUT_DIR}/index/{{organism}}.index.gs", organism=ORGANISMS)

rule download_sequence:
    params:
        organism_url = lambda wildcards: config[wildcards.organism]['fna']
    output: f"{OUTPUT_DIR}/raw/{{organism}}.fna"
    shell: "wget -O {output} {params.organism_url}"

rule guidescan_index:
    input: f"{OUTPUT_DIR}/raw/{{organism}}.fna"
    output: f"{OUTPUT_DIR}/index/{{organism}}.index.gs"
    shell: f"""
    cp {{input}} {{output}}
    """
# -----------------------------------------------------------------------------
